<html>

<head>
    <title>School Lessons</title>
    <script src="https://unpkg.com/vue"></script>
    <script src="lessons.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Big+Shoulders+Stencil+Text:wght@500&display=swap" rel="stylesheet">
</head>

<body>
    <div id="app">
        <header>
            <h1 v-text="sitename"></h1>
        </header>

        <main>
            <div v-if='showProduct'>

                <input type="radio" v-model="sortOrder" value='ascending'>
                Ascending

                <input type="radio" v-model="sortOrder" value='descending'>
                Descending

                <input type="radio" v-model="attribute" value="price">
                Price

                <input type="radio" v-model="attribute" value="subject">
                Subject

                <input type="radio" v-model="attribute" value="location">
                Location

                <input type="radio" v-model="attribute" value="space">
                Available Space


                <button class="cartBtn" v-on:click='showCheckout' v-if=cartItemCount>
                    {{ cartItemCount }}
                    <span class="fas fa-cart-plus"></span> Shopping Cart
                </button>
                <button class="cartBtn" disabled='disabled' v-else>
                    Shopping Cart
                </button>

                <div v-for="lesson in sortedProducts" class="border">

                    <figure>
                        <img v-bind:src="lesson.image" width=250px height=250px>
                    </figure>
                    <h2 v-text="lesson.title" class="sub"></h2>
                    <p class="details" v-html="lesson.location"></p>
                    <p class="details">Price: Dhs {{lesson.price}}</p>
                    <p class="details">Space: {{lesson.availableSpace}}</p>

                    <button class="addBtn" v-on:click="addToCart(lesson)" v-if="canAddToCart(lesson)">
                        Add to Cart
                    </button>

                    <button class="addBtn" disabled='disabled' v-else>
                        Add to Cart
                    </button>

                </div>
            </div>

            <div v-else>
                <button v-on:click='showCheckout'>Back</button>
                <h2> Shopping Cart </h2>
                <div v-for="(lesson, index) in cart" class="border">
                    <figure>
                        <img v-bind:src="lesson.image" width=250px height=250px>
                    </figure>
                    <h2 v-text="lesson.title" class="sub"></h2>
                    <p class="details" v-html="lesson.location"></p>
                    <p class="details">Price: Dhs {{lesson.price}}</p>
                    <button v-on:click="cart.splice(index, 1)" class="removeBtn">Remove</button>
                </div>

                <h2>Checkout</h2>
                <p>
                    <strong>Name: </strong>
                    <input data-type="alpha" type="text" v-model.trim="order.name" />
                </p>
                <p>
                    <strong>Phone: </strong>
                    <input v-model.trim="order.phone" />
                </p>

                <button v-on:click="submitForm" v-if="confirmCheckout">
                    Checkout
                </button>

                <button disabled='disabled' v-else>
                    Checkout
                </button>
            </div>
        </main>

    </div>

    <script type="text/javascript">
        var webstore = new Vue({
            el: '#app',
            data: {
                sitename: 'School Lessons',
                lessons: lessons,
                cart: [],
                showProduct: true,
                attribute: '',
                sortOrder: '',
                order: {
                    name: '',
                    phone: ''
                }
            },

            methods: {
                addToCart(lesson) {
                    this.cart.push(lesson);
                    lesson.availableSpace--;
                },

                canAddToCart(lesson) {
                    return lesson.availableSpace > 0;
                },

                cartCount(id) {
                    let count = 0;
                    for (let i = 0; i < this.cart.length; i++) {
                        if (this.cart[i] === id) {
                            count++;
                        }
                    }
                    return count;
                },

                showCheckout() {
                    this.showProduct = this.showProduct ? false : true;
                },

                submitForm() {
                    alert('Order submitted!');
                }
            },

            computed: {
                cartItemCount: function () {
                    return this.cart.length;
                },

                confirmCheckout() {
                    let letters = /^[A-Za-z]+$/;
                    let numbers = /^[0-9]+$/;
                    return letters.test(this.order.name) && numbers.test(this.order.phone);
                },

                sortedProducts() {
                    let lessonsArray = this.lessons.slice(0);
                    if (this.attribute == 'space') {
                        if (this.sortOrder == 'ascending') {
                            function compare(a, b) {
                                if (a.availableSpace > b.availableSpace)
                                    return 1;
                                if (a.availableSpace < b.availableSpace)
                                    return -1;
                                return 0;
                            }
                        }
                        else if (this.sortOrder == 'descending') {
                            function compare(a, b) {
                                if (a.availableSpace < b.availableSpace)
                                    return 1;
                                if (a.availableSpace > b.availableSpace)
                                    return -1;
                                return 0;
                            }
                        }
                    }

                    if (this.attribute == 'subject') {
                        if (this.sortOrder == 'ascending') {
                            function compare(a, b) {
                                if (a.title > b.title)
                                    return 1;
                                if (a.title < b.title)
                                    return -1;
                                return 0;
                            }
                        }
                        else if (this.sortOrder == 'descending') {
                            function compare(a, b) {
                                if (a.title < b.title)
                                    return 1;
                                if (a.title > b.title)
                                    return -1;
                                return 0;
                            }
                        }
                    }

                    if (this.attribute == 'price') {
                        if (this.sortOrder == 'ascending') {
                            function compare(a, b) {
                                if (a.price > b.price)
                                    return 1;
                                if (a.price < b.price)
                                    return -1;
                                return 0;
                            }
                        }
                        else if (this.sortOrder == 'descending') {
                            function compare(a, b) {
                                if (a.price < b.price)
                                    return 1;
                                if (a.price > b.price)
                                    return -1;
                                return 0;
                            }
                        }
                    }

                    if (this.attribute == 'location') {
                        if (this.sortOrder == 'ascending') {
                            function compare(a, b) {
                                if (a.location > b.location)
                                    return 1;
                                if (a.location < b.location)
                                    return -1;
                                return 0;
                            }
                        }
                        else if (this.sortOrder == 'descending') {
                            function compare(a, b) {
                                if (a.location < b.location)
                                    return 1;
                                if (a.location > b.location)
                                    return -1;
                                return 0;
                            }
                        }
                    }

                    return lessonsArray.sort(compare);
                }
            }
        })
    </script>

</body>

</html>